<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>StrumTrack: Blueprint</title>
    <style>
        :root { --bg: #05070a; --glass: rgba(20, 25, 35, 0.95); --accent: #00f2ff; --secondary: #7000ff; --text: #ffffff; --muted: #64748b; --danger: #ff4757; --success: #2ed573; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, system-ui, sans-serif; background: #05070a; color: var(--text); margin: 0; padding: 20px 20px 100px; overflow-x: hidden; }
        
        .container { max-width: 450px; margin: 0 auto; }
        .glass-card { background: var(--glass); backdrop-filter: blur(15px); border-radius: 20px; padding: 20px; margin-bottom: 16px; border: 1px solid rgba(255,255,255,0.08); box-shadow: 0 4px 20px rgba(0,0,0,0.4); }
        
        /* Navigation (Enlarged for Mobile) */
        .tab-bar { position: fixed; bottom: 0; left: 0; width: 100%; height: 85px; background: rgba(10, 15, 25, 0.98); display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #1e293b; z-index: 1000; padding-bottom:env(safe-area-inset-bottom); }
        .tab-item { color: var(--muted); font-size: 0.8rem; font-weight: 600; text-align: center; cursor: pointer; flex: 1; transition: 0.2s; display: flex; flex-direction: column; align-items: center; gap: 4px; }
        .tab-icon { font-size: 1.8rem; }
        .tab-item.active { color: var(--accent); transform: translateY(-4px); }
        
        .screen { display: none; }
        .screen.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* General UI */
        h2 { margin-top: 0; font-weight: 800; letter-spacing: -0.5px; }
        .label { font-size: 0.75rem; color: var(--muted); text-transform: uppercase; font-weight: bold; margin-bottom: 8px; display: block; }
        button { border: none; border-radius: 14px; font-weight: 800; cursor: pointer; transition: active 0.1s; }
        button:active { transform: scale(0.98); opacity: 0.9; }
        .btn-main { background: var(--accent); color: #000; padding: 14px 20px; width: 100%; font-size: 1rem; }
        .btn-outline { background: transparent; border: 2px solid var(--accent); color: var(--accent); padding: 10px; width: 100%; border-radius: 10px; margin-bottom: 8px; }
        
        input[type="text"], input[type="number"], select, textarea { width: 100%; background: rgba(0,0,0,0.4); border: 1px solid #1e293b; color: white; padding: 14px; border-radius: 12px; font-size: 1rem; margin-bottom: 12px; }
        textarea { height: 200px; font-family: 'Courier New', monospace; resize: none; }
        
        /* Specifics */
        .tuner-meter { width: 100%; height: 12px; background: #1e293b; border-radius: 6px; position: relative; margin: 25px 0; overflow: hidden; }
        .tuner-needle { position: absolute; top: 0; left: 50%; width: 5px; height: 100%; background: var(--accent); transform: translateX(-50%); transition: left 0.1s ease-out; }
        .timer-display { font-size: 4.5rem; font-weight: 900; color: var(--secondary); text-align: center; margin: 10px 0; font-variant-numeric: tabular-nums; }
        
        .routine-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 15px; }
    </style>
</head>
<body>

<div class="container">

    <div id="tuner" class="screen">
        <h2>Live Tuner</h2>
        <div class="glass-card" style="text-align:center;">
            <div id="noteName" style="font-size: 5rem; font-weight: 900; color: var(--accent); margin: 10px 0;">--</div>
            <div class="tuner-meter"><div id="needle" class="tuner-needle"></div></div>
            <div id="freq" style="font-family:monospace; color:var(--muted); margin-bottom: 20px;">Ready...</div>
            <button class="btn-main" id="tunerBtn" onclick="toggleTuner()">TURN ON TUNER</button>
        </div>
    </div>

    <div id="plan" class="screen active">
        <h2>24-Week Blueprint</h2>
        <div class="glass-card">
            <span class="label">Current Week Selection</span>
            <select id="weekSelect" onchange="updateBlueprintUI()">
                </select>
            
            <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 12px; margin-top: 10px; border-left: 4px solid var(--secondary);">
                <span class="label" style="color:var(--secondary)">Phase Focus</span>
                <div id="phaseDisplay" style="font-weight: bold; font-size: 1.1rem;">Phase 1: Technical Ceiling Reset</div>
            </div>
        </div>

        <div class="glass-card">
            <span class="label">Weekly Tracking Metrics</span>
            <input type="number" id="metricBpm" placeholder="Top Clean BPM (e.g. 120)">
            <input type="text" id="metricMechanic" placeholder="Weak Mechanic Identified">
            <select id="metricRecord">
                <option value="No">Recording Completed? - No</option>
                <option value="Yes">Recording Completed? - Yes</option>
            </select>
            <input type="text" id="metricNotes" placeholder="Quick Notes...">
            <button class="btn-main" onclick="saveMetrics()">SAVE WEEKLY METRICS</button>
            <div id="saveConfirm" style="color: var(--success); text-align: center; margin-top: 10px; font-size: 0.8rem; display: none;">Data Saved Successfully!</div>
        </div>

        <div class="glass-card">
            <span class="label">Master Video Study List</span>
            <div id="videoChecklist"></div>
        </div>
    </div>

    <div id="practice" class="screen">
        <h2>Daily Routine</h2>
        
        <div class="glass-card">
            <span class="label">30-Minute Structure</span>
            <div class="routine-grid">
                <button class="btn-outline" onclick="setTimer(4, 'Neural Warmup')">4m - Neural Warmup</button>
                <button class="btn-outline" onclick="setTimer(8, 'Technical Overload')">8m - Tech Overload</button>
                <button class="btn-outline" onclick="setTimer(6, 'Harmonic Intel')">6m - Harmonic Intel</button>
                <button class="btn-outline" onclick="setTimer(6, 'Rhythmic Control')">6m - Rhythmic Control</button>
                <button class="btn-outline" style="grid-column: span 2;" onclick="setTimer(6, 'Composition Constraint')">6m - Composition Constraint</button>
            </div>
        </div>

        <div class="glass-card" style="text-align:center;">
            <div id="sessionFocus" style="color:var(--muted); font-weight:bold;">Custom Session</div>
            <div class="timer-display" id="timerDisplay">00:00</div>
            
            <div style="display:flex; justify-content:center; gap:10px; margin-bottom:15px;">
                <button onclick="adjustTime(-1)" style="padding:10px 15px; border-radius:10px; background:#1e293b; color:white; border:none; font-weight:bold;">-1m</button>
                <button onclick="adjustTime(1)" style="padding:10px 15px; border-radius:10px; background:#1e293b; color:white; border:none; font-weight:bold;">+1m</button>
            </div>

            <button class="btn-main" style="background:var(--secondary); color:white;" id="timerBtn" onclick="toggleTimer()">START SESSION</button>
        </div>
    </div>

    <div id="write" class="screen">
        <h2>Scratchpad</h2>
        <div class="glass-card">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 8px;">
                <span class="label" style="margin:0;">Notes & Tabs</span>
                <span id="writeSaveInd" style="color:var(--success); font-size:0.7rem; display:none;">Saved!</span>
            </div>
            <textarea id="notes" placeholder="Paste tabs, lyrics, or scale intervals here..." oninput="saveNotes()"></textarea>
            <p style="font-size:0.75rem; color:var(--muted); margin:0;">Saves to your device automatically.</p>
        </div>
    </div>

</div>

<nav class="tab-bar">
    <div class="tab-item" onclick="showScreen('tuner', this)">
        <span class="tab-icon">üé∏</span><span>Tuner</span>
    </div>
    <div class="tab-item active" onclick="showScreen('plan', this)">
        <span class="tab-icon">üìã</span><span>Plan</span>
    </div>
    <div class="tab-item" onclick="showScreen('practice', this)">
        <span class="tab-icon">‚è±Ô∏è</span><span>Practice</span>
    </div>
    <div class="tab-item" onclick="showScreen('write', this)">
        <span class="tab-icon">üìù</span><span>Write</span>
    </div>
</nav>

<script>
    // --- Navigation ---
    const showScreen = (id, el) => {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        el.classList.add('active');
    };

    // --- Blueprint Logic (24 Weeks) ---
    const phases = [
        { weeks: [1,2,3,4], name: "Phase 1: Technical Ceiling Reset" },
        { weeks: [5,6,7,8], name: "Phase 2: Harmonic Expansion" },
        { weeks: [9,10,11,12], name: "Phase 3: Rhythmic Authority" },
        { weeks: [13,14,15,16], name: "Phase 4: Speed + Musical Control" },
        { weeks: [17,18,19,20], name: "Phase 5: Modern Rock Mastery" },
        { weeks: [21,22,23,24], name: "Phase 6: Professional Integration" }
    ];

    const weekSelect = document.getElementById('weekSelect');
    for(let i=1; i<=24; i++) {
        let opt = document.createElement('option');
        opt.value = i; opt.innerText = `Week ${i}`;
        weekSelect.appendChild(opt);
    }

    function updateBlueprintUI() {
        const currentWeek = parseInt(weekSelect.value);
        const phase = phases.find(p => p.weeks.includes(currentWeek));
        document.getElementById('phaseDisplay').innerText = phase ? phase.name : "";
        
        const data = JSON.parse(localStorage.getItem('gtr_blueprint') || '{}');
        const weekData = data[currentWeek] || { bpm: '', mechanic: '', record: 'No', notes: '' };
        
        document.getElementById('metricBpm').value = weekData.bpm;
        document.getElementById('metricMechanic').value = weekData.mechanic;
        document.getElementById('metricRecord').value = weekData.record;
        document.getElementById('metricNotes').value = weekData.notes;
    }

    function saveMetrics() {
        const currentWeek = parseInt(weekSelect.value);
        const data = JSON.parse(localStorage.getItem('gtr_blueprint') || '{}');
        data[currentWeek] = {
            bpm: document.getElementById('metricBpm').value,
            mechanic: document.getElementById('metricMechanic').value,
            record: document.getElementById('metricRecord').value,
            notes: document.getElementById('metricNotes').value
        };
        localStorage.setItem('gtr_blueprint', JSON.stringify(data));
        
        const confirm = document.getElementById('saveConfirm');
        confirm.style.display = 'block';
        setTimeout(() => confirm.style.display = 'none', 2000);
    }
    updateBlueprintUI();

    // --- Video Study Checklist ---
    const studyVideos = [
        { id: "v1", title: "Troy Grady - Cracking the Code", link: "https://www.youtube.com/results?search_query=troy+grady+cracking+the+code" },
        { id: "v2", title: "Rick Beato - Modes Explained", link: "https://www.youtube.com/results?search_query=rick+beato+modes+explained" },
        { id: "v3", title: "Paul Gilbert - Alternate Picking", link: "https://www.youtube.com/results?search_query=paul+gilbert+alternate+picking+lesson" },
        { id: "v4", title: "Bernth - Advanced Legato", link: "https://www.youtube.com/results?search_query=bernth+legato+workout" },
        { id: "v5", title: "Steve Stine - String Skipping", link: "https://www.youtube.com/results?search_query=steve+stine+string+skipping" },
        { id: "v6", title: "Odd Time Riff (7/8 & 5/4)", link: "https://www.youtube.com/results?search_query=7%2F8+rock+backing+track" },
        { id: "v7", title: "Drum Loop Practice Tracks", link: "https://www.youtube.com/results?search_query=rock+drum+loop+practice" }
    ];

    function renderVideos() {
        const savedState = JSON.parse(localStorage.getItem('gtr_videos') || '{}');
        const container = document.getElementById('videoChecklist');
        container.innerHTML = studyVideos.map(v => `
            <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.05);">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <input type="checkbox" id="${v.id}" ${savedState[v.id] ? 'checked' : ''} onchange="saveVideoState('${v.id}')" style="width: 20px; height: 20px; accent-color: var(--accent); margin:0;">
                    <label for="${v.id}" style="font-size: 0.9rem; font-weight: 500; cursor: pointer; ${savedState[v.id] ? 'text-decoration: line-through; color: var(--muted);' : ''}">${v.title}</label>
                </div>
                <a href="${v.link}" target="_blank" style="text-decoration: none; font-size: 1.4rem;">‚ñ∂Ô∏è</a>
            </div>
        `).join('');
    }

    function saveVideoState(id) {
        const savedState = JSON.parse(localStorage.getItem('gtr_videos') || '{}');
        savedState[id] = document.getElementById(id).checked;
        localStorage.setItem('gtr_videos', JSON.stringify(savedState));
        renderVideos(); 
    }
    renderVideos();

    // --- Daily Routine Timer Logic ---
    let tLeft = 0, tID, tActive = false;
    let baseMins = 0;

    function setTimer(mins, focusText) {
        if(tActive) return alert("Stop current session first!");
        baseMins = mins;
        tLeft = mins * 60;
        document.getElementById('sessionFocus').innerText = focusText;
        renderT();
    }

    function adjustTime(change) {
        if(tActive) return;
        baseMins = Math.max(1, baseMins + change);
        tLeft = baseMins * 60;
        document.getElementById('sessionFocus').innerText = "Custom Session";
        renderT();
    }

    const toggleTimer = () => {
        if(baseMins === 0) return alert("Select a routine block or add minutes first.");
        if (!tActive) {
            tActive = true; 
            tID = setInterval(() => {
                tLeft--; renderT();
                if (tLeft <= 0) { 
                    clearInterval(tID); 
                    tActive = false;
                    document.getElementById('timerBtn').innerText = "START SESSION";
                    alert("Block Complete! Time for the next one."); 
                }
            }, 1000);
            document.getElementById('timerBtn').innerText = "PAUSE";
        } else { 
            clearInterval(tID); 
            tActive = false; 
            document.getElementById('timerBtn').innerText = "RESUME"; 
        }
    };

    const renderT = () => {
        const m = Math.floor(tLeft / 60); const s = tLeft % 60;
        document.getElementById('timerDisplay').innerText = `${m < 10 ? '0'+m : m}:${s < 10 ? '0'+s : s}`;
    };

    // --- Tuner Logic (With strict On/Off) ---
    let tCtx, tAnalys, tData, micStream;
    let isTunerOn = false;
    const nNames = ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"];
    
    async function toggleTuner() {
        if (isTunerOn) {
            // Turn Off completely
            if(micStream) micStream.getTracks().forEach(track => track.stop());
            if(tCtx && tCtx.state !== 'closed') await tCtx.close();
            isTunerOn = false;
            document.getElementById('tunerBtn').innerText = "TURN ON TUNER";
            document.getElementById('tunerBtn').style.background = "var(--accent)";
            document.getElementById('freq').innerText = "Off";
            document.getElementById('noteName').innerText = "--";
            document.getElementById('needle').style.left = "50%";
            document.getElementById('needle').style.background = "var(--accent)";
        } else {
            // Turn On
            try {
                tCtx = new (window.AudioContext || window.webkitAudioContext)();
                micStream = await navigator.mediaDevices.getUserMedia({ audio: true });
                const source = tCtx.createMediaStreamSource(micStream);
                tAnalys = tCtx.createAnalyser();
                tAnalys.fftSize = 4096;
                source.connect(tAnalys);
                tData = new Float32Array(tAnalys.frequencyBinCount);
                
                isTunerOn = true;
                document.getElementById('tunerBtn').innerText = "TURN OFF TUNER";
                document.getElementById('tunerBtn').style.background = "var(--danger)";
                tickTuner();
            } catch(e) { alert("Microphone access is required for the tuner."); }
        }
    }

    function tickTuner() {
        if(!isTunerOn) return; 
        tAnalys.getFloatFrequencyData(tData);
        let maxV = -Infinity, maxB = -1;
        for (let i = 0; i < tData.length; i++) { if (tData[i] > maxV) { maxV = tData[i]; maxB = i; } }
        let f = maxB * tCtx.sampleRate / tAnalys.fftSize;
        if (maxV > -60 && f > 40 && f < 1000) {
            document.getElementById('freq').innerText = f.toFixed(1) + " Hz";
            let p = 12 * (Math.log2(f / 440)) + 69;
            let n = Math.round(p) % 12;
            document.getElementById('noteName').innerText = nNames[n];
            let d = (p - Math.round(p)) * 100;
            document.getElementById('needle').style.left = (50 + d/2) + "%";
            document.getElementById('needle').style.background = Math.abs(d) < 5 ? "var(--success)" : "var(--danger)";
        }
        requestAnimationFrame(tickTuner);
    }

    // --- Scratchpad Logic ---
    let saveTimeout;
    const saveNotes = () => {
        localStorage.setItem('gtr_notes_final', document.getElementById('notes').value);
        const ind = document.getElementById('writeSaveInd');
        ind.style.display = 'block';
        clearTimeout(saveTimeout);
        saveTimeout = setTimeout(() => ind.style.display = 'none', 1500);
    };
    document.getElementById('notes').value = localStorage.getItem('gtr_notes_final') || '';

</script>
</body>
</html>
